const User = require("../../../models/user");


async function handleJoinClub (ctx) {
    const user = await User.findOne({ telegramId: ctx.from.id });
    const groupLink = process.env.GROUP_LINK;
    if (user && user.joinedClub) {
        return ctx.reply(`–í—ã —É–∂–µ –≤ –∫–ª—É–±–µ! –í–æ—Ç —Å—Å—ã–ª–∫–∞ –Ω–∞ –≥—Ä—É–ø–ø—É:\n${groupLink}`);
    }
    const clubPolicy = `
      –£–º–æ–≤–∏ —É—á–∞—Å—Ç—ñ –≤ Pixel Fighter
    
    –õ–∞—Å–∫–∞–≤–æ –ø—Ä–æ—Å–∏–º–æ –¥–æ Pixel Fighter ‚Äì –¥–∏—Ç—è—á–æ–≥–æ –≤–µ–ª–æ–∫–ª—É–±—É, –¥–µ —Å–ø–æ—Ä—Ç –ø–µ—Ä–µ—Ç–≤–æ—Ä—é—î—Ç—å—Å—è –Ω–∞ —Å–ø—Ä–∞–≤–∂–Ω—é –≥—Ä—É! üö¥‚Äç‚ôÄÔ∏èüéÆ
    
    –•—Ç–æ –º–æ–∂–µ –±—Ä–∞—Ç–∏ —É—á–∞—Å—Ç—å:
    –£—Å—ñ –¥—ñ—Ç–∏ –≤—ñ–¥ 6 —Ä–æ–∫—ñ–≤, —è–∫—ñ –ª—é–±–ª—è—Ç—å –∫–∞—Ç–∞—Ç–∏—Å—è –Ω–∞ –≤–µ–ª–æ—Å–∏–ø–µ–¥—ñ —Ç–∞ —Ö–æ—á—É—Ç—å —Ç—Ä–µ–Ω—É–≤–∞—Ç–∏—Å—å —É –¥—Ä—É–∂–Ω—ñ–π –∫–æ–º–ø–∞–Ω—ñ—ó.
    
    –£–º–æ–≤–∏:
    - –£—á–∞—Å—Ç—å –±–µ–∑–∫–æ—à—Ç–æ–≤–Ω–∞.
    - –ö—É–ø—É–≤–∞—Ç–∏ —Ñ–æ—Ä–º—É **–Ω–µ –æ–±–æ–≤‚Äô—è–∑–∫–æ–≤–æ**, –∞–ª–µ –∑–∞ –±–∞–∂–∞–Ω–Ω—è–º —ó—ó –º–æ–∂–Ω–∞ –±—É–¥–µ –∑–∞–º–æ–≤–∏—Ç–∏.
    - –ì–æ–ª–æ–≤–Ω–µ ‚Äì –±–∞–∂–∞–Ω–Ω—è –≤—á–∏—Ç–∏—Å—å, —Ä–æ–∑–≤–∏–≤–∞—Ç–∏—Å—å —Ç–∞ –≤–µ—Å–µ–ª–æ –ø—Ä–æ–≤–æ–¥–∏—Ç–∏ —á–∞—Å!
    
     –©–æ –≤–∏ –æ—Ç—Ä–∏–º–∞—î—Ç–µ:
    - –í–µ—Å–µ–ª—ñ —Ç—Ä–µ–Ω—É–≤–∞–Ω–Ω—è –∑ –¥–æ—Å–≤—ñ–¥—á–µ–Ω–∏–º–∏ —Ç—Ä–µ–Ω–µ—Ä–∞–º–∏.
    - –ù–æ–≤–∏—Ö –¥—Ä—É–∑—ñ–≤ —Ç–∞ –∫–æ–º–∞–Ω–¥–Ω–∏–π –¥—É—Ö.
    - –£—á–∞—Å—Ç—å —É –≤–µ–ª–æ—ñ–≥—Ä–∞—Ö, –∫–≤–µ—Å—Ç–∞—Ö —Ç–∞ –∑–º–∞–≥–∞–Ω–Ω—è—Ö.
    - –ú–æ–∂–ª–∏–≤—ñ—Å—Ç—å —Å—Ç–∞—Ç–∏ —Å–∏–ª—å–Ω—ñ—à–∏–º —ñ –≤–ø–µ–≤–Ω–µ–Ω—ñ—à–∏–º —Å–ø–æ—Ä—Ç—Å–º–µ–Ω–æ–º.
    
     –©–æ –º–∏ –æ—á—ñ–∫—É—î–º–æ:
    - –ë—É—Ç–∏ –¥–æ–±—Ä–æ–∑–∏—á–ª–∏–≤–∏–º–∏ —Ç–∞ –ø–æ–≤–∞–∂–∞—Ç–∏ —ñ–Ω—à–∏—Ö —É—á–∞—Å–Ω–∏–∫—ñ–≤ —ñ —Ç—Ä–µ–Ω–µ—Ä—ñ–≤.
    - –î–æ—Ç—Ä–∏–º—É–≤–∞—Ç–∏—Å—å –ø—Ä–∞–≤–∏–ª –±–µ–∑–ø–µ–∫–∏.
    - –ü—ñ–¥—Ç—Ä–∏–º—É–≤–∞—Ç–∏ —Å–≤–æ—é –∫–æ–º–∞–Ω–¥—É.
    
     –ü—ñ–¥—Ç–≤–µ—Ä–¥–∂–µ–Ω–Ω—è:
    –î–∏—Ç–∏–Ω–∞ —Ç–∞ –±–∞—Ç—å–∫–∏ –ø–æ–≥–æ–¥–∂—É—é—Ç—å—Å—è –∑ —Ü–∏–º–∏ –ø—Ä–æ—Å—Ç–∏–º–∏ –ø—Ä–∞–≤–∏–ª–∞–º–∏ –π –≥–æ—Ç–æ–≤—ñ —Å—Ç–∞—Ç–∏ —á–∞—Å—Ç–∏–Ω–æ—é –∫–æ–º–∞–Ω–¥–∏ Pixel Fighter.
`;

    try {
        console.log('–û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç—Ä–∞–∫—Ç —Å –∫–Ω–æ–ø–∫–∞–º–∏');
        await ctx.reply(clubPolicy, {
            reply_markup: {
                inline_keyboard: [
                    [
                        { text: '–í—Å—Ç—É–ø–∏—Ç—å', callback_data: 'join_agree' },
                        { text: '–û—Ç–∫–∞–∑–∞—Ç—å—Å—è', callback_data: 'join_decline' }
                    ]
                ]
            }
        });
    } catch (err) {
        console.error('–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ —Å–æ–æ–±—â–µ–Ω–∏—è:', err);
        await ctx.reply('–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ —Å–Ω–æ–≤–∞.');
    }
}

module.exports = handleJoinClub;